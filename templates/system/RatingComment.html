<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>StockPage</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.2/dist/full.min.css" rel="stylesheet" type="text/css" />
</head>
<body>
    <div id="app" class="flex h-screen">
      <!-- Left Sidebar -->
      <div class="w-16 flex flex-col justify-between border-e bg-white h-screen fixed">
        <div>
          <div class="inline-flex size-16 items-center justify-center">
            <span class="grid size-10 place-content-center rounded-lg bg-gray-100 text-xs text-gray-600">[[user.userName.substring(0, 2)]]</span>
          </div>
          <div class="border-t border-gray-100">
            <div class="px-2">
              <div class="py-4">
                <a href="/preference" class="t group relative flex justify-center rounded bg-blue-50 px-2 py-1.5 text-blue-700">
                  <svg xmlns="http://www.w3.org/2000/svg" class="size-5 opacity-75" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                  </svg>
                  <span class="invisible absolute start-full top-1/2 ms-4 -translate-y-1/2 rounded bg-gray-900 px-2 py-1.5 text-xs font-medium text-white group-hover:visible">General</span>
                </a>
              </div>
              <ul class="space-y-1 border-t border-gray-100 pt-4">
                <li>
                  <a :href="`/space/${user.accountId}`" class="group relative flex justify-center rounded px-2 py-1.5 text-gray-500 hover:bg-gray-50 hover:text-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5.52 19c.64-2.2 1.84-3 3.22-3h6.52c1.38 0 2.58.8 3.22 3"/><circle cx="12" cy="10" r="3"/><circle cx="12" cy="12" r="10"/></svg>
                    <span class="invisible absolute start-full top-1/2 ms-4 -translate-y-1/2 rounded bg-gray-900 px-2 py-1.5 text-xs font-medium text-white group-hover:visible">My Account</span>
                  </a>
                </li>
                <li>
                  <a :href="`/space/${user.accountId}?page=watchList`"
                     class="group relative flex justify-center rounded px-2 py-1.5 text-gray-500 hover:bg-gray-50 hover:text-gray-700"
                      v-if="user.profile === 'premium'">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
                    <span class="invisible absolute start-full top-1/2 ms-4 -translate-y-1/2 rounded bg-gray-900 px-2 py-1.5 text-xs font-medium text-white group-hover:visible">Favourites</span>
                  </a>
                </li>
                <li>
                  <a href="/friend" class="group relative flex justify-center rounded px-2 py-1.5 text-gray-500 hover:bg-gray-50 hover:text-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                    <span class="invisible absolute start-full top-1/2 ms-4 -translate-y-1/2 rounded bg-gray-900 px-2 py-1.5 text-xs font-medium text-white group-hover:visible">Friend</span>
                  </a>
                </li>
                <li>
                  <a href="/history" class="group relative flex justify-center rounded px-2 py-1.5 text-gray-500 hover:bg-gray-50 hover:text-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
                    <span class="invisible absolute start-full top-1/2 ms-4 -translate-y-1/2 rounded bg-gray-900 px-2 py-1.5 text-xs font-medium text-white group-hover:visible">History Search</span>
                  </a>
                </li>
                <li>
                  <a href="/ratingComment" class="group relative flex justify-center rounded px-2 py-1.5 text-gray-500 hover:bg-gray-50 hover:text-gray-700">
                    <svg class="h-6 w-6 text-gray-900" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/>
                    </svg>
                    <span class="invisible absolute start-full top-1/2 ms-4 -translate-y-1/2 rounded bg-gray-900 px-2 py-1.5 text-xs font-medium text-white group-hover:visible">Comment</span>
                  </a>
                </li>
                                                          <li v-if="user.profile === 'premium'">
                  <a href="/api" class="group relative flex justify-center rounded px-2 py-1.5 hover:bg-gray-50 hover:text-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-file-earmark-code" viewBox="0 0 16 16">
                      <path d="M14 4.5V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h5.5zm-3 0A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4.5z"/>
                      <path d="M8.646 6.646a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1 0 .708l-2 2a.5.5 0 0 1-.708-.708L10.293 9 8.646 7.354a.5.5 0 0 1 0-.708m-1.292 0a.5.5 0 0 0-.708 0l-2 2a.5.5 0 0 0 0 .708l2 2a.5.5 0 0 0 .708-.708L5.707 9l1.647-1.646a.5.5 0 0 0 0-.708"/>
                    </svg>
                    <span class="invisible absolute start-full top-1/2 ms-4 -translate-y-1/2 rounded bg-gray-900 px-2 py-1.5 text-xs font-medium text-white group-hover:visible">API</span>
                  </a>
                </li>
                                                                                              <li v-if="user.profile === 'premium'">
                  <a href="/predictionData" class="group relative flex justify-center rounded px-2 py-1.5 hover:bg-gray-50">
<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor" class="bi bi-bar-chart" viewBox="0 0 16 16">
  <path d="M4 11H2v3h2zm5-4H7v7h2zm5-5v12h-2V2zm-2-1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zM6 7a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v7a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1zm-5 4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1z"/>
</svg>
                    <span class="invisible absolute start-full top-1/2 ms-4 -translate-y-1/2 rounded bg-gray-900 px-2 py-1.5 text-xs font-medium text-white group-hover:visible">PredictionData</span>
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </div>
        <div class="sticky inset-x-0 bottom-0 border-t border-gray-100 bg-white p-2">
          <form action="/logout">
            <button type="submit" class="group relative flex w-full justify-center rounded-lg px-2 py-1.5 text-sm text-gray-500 hover:bg-gray-50 hover:text-gray-700">
              <svg xmlns="http://www.w3.org/2000/svg" class="size-5 opacity-75" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
              </svg>
              <span class="invisible absolute start-full top-1/2 ms-4 -translate-y-1/2 rounded bg-gray-900 px-2 py-1.5 text-xs font-medium text-white group-hover:visible">Logout</span>
            </button>
          </form>
        </div>
      </div>
      <div class="flex-1 bg-gray-100 ml-16">
        <div class="navbar bg-base-100/95 fixed top-0 w-[calc(100%-4rem)]">
            <div class="">
                <a class="btn btn-ghost text-xl" href="/mainPage">Stock4Me</a>
            </div>
                <input type="text" placeholder="Search symbol or accounts..." class="input input-sm input-bordered w-80 ml-4" v-model="search">
        <button class="btn btn-outline btn-sm btn-success ml-2" @click="doSearch">Search</button>
            </div>
          <div class="overflow-y-scroll p-8 bg-white border mt-16">
            <h2 class="text-xl font-bold mb-4 text-black">How would you rate our product?</h2>
            <div v-if="Object.keys(userReview).length === 0">
    <div class="rating rating-lg rating-half mb-4">
      <input v-for="n in 10" type="radio" :key="n" name="rating-10" :class="getClass(n)" @click="setRating(n)" :checked="rating === n">
    </div>
              <p class="text-sm">Now Rating: <b>[[ rating / 2 ]]</b> Star</p>

            <h2 class="text-xl font-bold mb-2 mt-6 text-black">What do you think of our service?</h2>
            <p class="text-gray-600 text-sm mb-4">Good comments have a chance to be selected by our administrators and recommended to the homepage!</p>
            <div class="max-w-2xl">
              <label for="OrderNotes" class="sr-only">Order notes</label>
              <div class="overflow-hidden rounded-lg border border-gray-200 shadow-sm focus-within:border-blue-600 focus-within:ring-1 focus-within:ring-blue-600">
                <textarea
                  id="OrderNotes"
                  class="w-full resize-none border-none align-top focus:ring-0 sm:text-sm bg-transparent text-black"
                  rows="4"
                  placeholder="Enter your comment here..."
                  v-model="comment"
                ></textarea>
              </div>
              <div class="flex items-center justify-end gap-2 bg-white p-3">
                <button
                  type="button"
                  class="rounded bg-gray-200 px-3 py-1.5 text-sm font-medium text-gray-700 hover:text-gray-600"
                  @click="clearText()"
                  v-if="!isButtonDisabled"
                >
                  Clear
                </button>
                <button
                  type="button"
                  class="rounded bg-indigo-600 px-3 py-1.5 text-sm font-medium text-white hover:bg-indigo-700"
                  @click="sendRequest()" :disabled="isButtonDisabled"
                  v-if="!isButtonDisabled"
                >
                  Confirm
                </button>
                  <p v-if="isButtonDisabled">Please wait <b>[[ remainingTime ]]</b> seconds to send again</p>
              </div>
            </div>
          </div>
<!--           if user already have reviews and comments   -->
              <div class="flex flex-col gap-y-4" v-if="Object.keys(userReview).length !== 0">
                  <span class="text-sm"><span class="text-xl">Thanks!</span> You have already given review to our products, <br>now you can update or delete it.</span>
                    <div class="rating rating-md rating-half">
                      <input v-for="n in 10"
                             type="radio"
                             :key="n"
                             :name="'rating-' + userReview.rating"
                             :class="getClass(n)"
                             @click="setUpdateRating(n/2)"
                             :checked="userReview.rating === n/2">
                    </div>
                  <p class="text-sm">Now Rating: <b>[[ userReview.rating ]]</b> Star</p>
                  <textarea class="textarea textarea-warning w-96" placeholder="Bio" v-model="userReview.reviewText"></textarea>
                  <div class="flex flex-row w-96 justify-end gap-x-4">
                      <button class="btn btn-outline btn-warning btn-sm" @click="updateRequest" v-if="!isButtonDisabled">Update</button>
                      <button class="btn btn-outline btn-error btn-sm" v-if="!isButtonDisabled" @click="deleteReview">Delete</button>
                      <p v-if="isButtonDisabled">Please wait <b>[[ remainingTime ]]</b> seconds to update again</p>
                  </div>
              </div>
          </div>
          <!-- Content END! -->
    <!-- To The Top Button -->
    <button id="toTopButton" class="fixed bottom-4 right-4 bg-blue-500 text-white p-3 rounded-full shadow-lg hover:bg-blue-700 focus:outline-none hidden">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
      </svg>
  </button>
        </div>
            <dialog id="success" class="modal modal-bottom sm:modal-middle">
  <div class="modal-box bg-sky-300">
    <h3 class="font-bold text-lg">Success</h3>
    <p class="py-4">[[message]]</p>
    <div class="modal-action">
      <form method="dialog">
        <button class="btn bg-sky-100">OK</button>
      </form>
    </div>
  </div>
</dialog>
        </div>


  <script>
    new Vue({
      el: '#app',
      delimiters: ['[[', ']]'],
      data: {
        user:JSON.parse('{{user|tojson}}'),
        rating: 10,
        comment: "",
        message: "",
        isButtonDisabled: false,
        remainingTime: 10,
        userReview:JSON.parse('{{userReview|tojson}}'),
          search:'',
      },
      methods: {
          updateRating(newRating) {
        this.userReview.rating = newRating;
    },
          doSearch(){
                    window.location.href = `/search/${this.search}`;
                },
          updateRequest(){
              if (this.isButtonDisabled) return;
                        axios.post('/ratingComment', {
            comment: this.userReview.reviewText,
            rating: this.userReview.rating/2
          })
          .then(response => {
            this.message = "You have successfully update your comment, our administrator will see it soon!";
            document.getElementById('success').showModal();
            this.startTimer();
          })
          .catch(error => {
            console.error('Bad:', error);
          });
        },
          deleteReview(){
            axios.post(`/deleteReview/${this.userReview.reviewId}`)
                .then(response =>{
                    this.userReview = [];
                    this.rating = 10;
                    this.clearText()
                    this.message = "You have successfully delete a comment, you can send again!";
                    document.getElementById('success').showModal();
                })
          },
        sendRequest() {
            axios.post('/ratingComment', {
            comment: this.comment,
            rating: this.rating / 2
          })
          .then(response => {
              axios.get('/getRatingCommentById')
                  .then(response =>{
                      this.userReview = response.data
                      console.log(this.userReview)
                  })
            this.message = "Congratulations, you have successfully submitted a comment, our administrator will see it soon!";
            document.getElementById('success').showModal();
            this.startTimer();
          })
          .catch(error => {
            console.error('Bad:', error);
          });
        },
        clearText() {
          this.comment = "";
        },
        setRating(value) {
          this.rating = value;
        },
          setUpdateRating(value){
            this.userReview.rating = value;
          },
        getClass(index) {
          const half = index % 2 === 1 ? 'mask-half-1' : 'mask-half-2';
          return `mask mask-star-2 ${half} bg-orange-400`;
        },
        startTimer() {
          const currentTime = new Date().getTime();
          const endTime = currentTime + 10000; // 10seconds
          localStorage.setItem('endTime', endTime);
          this.isButtonDisabled = true;
          this.updateRemainingTime();
        },
        updateRemainingTime() {
          const interval = setInterval(() => {
            const currentTime = new Date().getTime();
            const endTime = localStorage.getItem('endTime');
            this.remainingTime = Math.max(Math.floor((endTime - currentTime) / 1000), 0);
            if (this.remainingTime <= 0) {
              clearInterval(interval);
              this.isButtonDisabled = false;
              localStorage.removeItem('endTime');
            }
          }, 1000);
        },
        checkRemainingTime() {
          const currentTime = new Date().getTime();
          const endTime = localStorage.getItem('endTime');
          if (endTime && currentTime < endTime) {
            this.isButtonDisabled = true;
            this.updateRemainingTime();
          }
        }
      },
      mounted() {
        this.checkRemainingTime();

        // Scroll to the top when the button is clicked
        document.getElementById('toTopButton').addEventListener('click', () => {
          window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Show or hide the button based on scroll position
        window.addEventListener('scroll', () => {
          if (window.scrollY > 200) {
            document.getElementById('toTopButton').classList.remove('hidden');
          } else {
            document.getElementById('toTopButton').classList.add('hidden');
          }
        });
      }
    });
  </script>

</body>
</html>
